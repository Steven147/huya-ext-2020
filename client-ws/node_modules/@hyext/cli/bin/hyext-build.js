#!/usr/bin/env node

const path = require('path')
const commander = require('commander')
const packageJson = require('../package.json')
const readProjectConfig = require('../lib/readProjectConfig')

const program = new commander.Command(packageJson.name)
  .usage('build [--mode development|production]')
  .option('-m, --mode <mode>', 'set mode, Default: development')
  .parse(process.argv);

let mode = program.mode

if (mode !== 'production') {
  mode = 'development'
}

const projectCfg = readProjectConfig()

let builder = require( path.resolve(process.cwd(), 'node_modules', projectCfg.builder.name) )

builder.build({
  projectName: projectCfg.name,
  mode,
  config: projectCfg.builder.config,
  inputPath: projectCfg.inputPath,
  outputPath: projectCfg.outputPath,
  publicPath: projectCfg.publicPath,
  releasePath: projectCfg.releasePath,
})
