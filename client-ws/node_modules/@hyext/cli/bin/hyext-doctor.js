const fs = require('fs-extra')
const path = require('path')
const chalk = require('chalk')
const childProcess = require('child_process')

function doctor() {
  const projectDir = process.cwd()

  const output = childProcess.execSync('npm config ls')
  console.log(
    chalk.green('\nDOCTOR: npm config:')
  )
  console.log(output.toString())


  console.log(
    chalk.green('\nDOCTOR: package.json')
  )
  console.log(fs.readFileSync(path.resolve(projectDir, 'package.json')).toString())

  console.log(
    chalk.green('\nDOCTOR: project.config.json')
  )
  console.log(fs.readFileSync(path.resolve(projectDir, 'project.config.json')).toString())

  let list
  try {
    list = childProcess.execSync('npm ls --depth 0')
  } catch (err) {
    if (err && err.stdout) {
      list = err.stdout
    } else {
      list = fs.readdirSync(path.resolve(projectDir, 'node_modules/@hyext')).join('\n')
    }
  }

  console.log(
    chalk.green('\nDOCTOR: installed packages')
  )

  console.log(list.toString())
}

doctor()
