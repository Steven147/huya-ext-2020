/*
 * @Author: Huya
 * @Date: 2019-03-26 09:27:49
 */

import { AppState } from 'react-native'

class ExtAppState {
  constructor() {
    this._appState = AppState.currentState;
    this.enterForegroundCallback = [];
    this.leaveForegroundCallback = [];

    AppState.addEventListener('change', (nextAppState) => {
      if (this._appState.match(/inactive|background/) && nextAppState === 'active') {
        for (var i in this.enterForegroundCallback) {
          callback = this.enterForegroundCallback[i];
          callback();
        }
      }
      else if (this._appState === 'active' && nextAppState.match(/inactive|background/)) {
        for (var i in this.leaveForegroundCallback) {
          callback = this.leaveForegroundCallback[i];
          callback();
        }
      }
      this._appState = nextAppState;
    });
  }

  onEnterForeground(callback) {
    this.enterForegroundCallback.push(callback);
  }

  onLeaveForeground(callback) {
    this.leaveForegroundCallback.push(callback);
  }
}

const HYExtAppState = new ExtAppState();
export default HYExtAppState;