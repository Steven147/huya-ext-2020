const fs = require('fs-extra')
const path = require('path')
/*
 * 将 config 里涉及的文件拷贝到 launcherDir 中去
 *
 */

const PROJECT_ASSETS_DIRNAME = 'project_assets'
const COPY_KEYS = ['logo']

function copyConfigAssets({ projectDir, launcherDir, config }) {
  const destDir = path.join(launcherDir, PROJECT_ASSETS_DIRNAME)
  COPY_KEYS.forEach(k => {
    if (!config[k]) {
      return
    }

    const src = path.join(projectDir, config[k])
    if (!fs.existsSync(src)) {
      return
    }

    if (fs.lstatSync(src).isDirectory()) {
      // 目前只支持拷贝文件
      console.error(`${src}不是文件`)
      return
    }

    // 保持相对路径不变
    const dest = path.join(destDir, config[k])
    fs.copySync(src, dest)
  })
}

module.exports = {
  copyConfigAssets,
}
