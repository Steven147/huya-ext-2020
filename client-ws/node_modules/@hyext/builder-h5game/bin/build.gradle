version '1.0.0-SNAPSHOT'

buildscript {
    repositories {
        mavenCentral()
        // 线上
        flatDir { dirs './hyg-libs' }
        // 本地测试
        // flatDir { dirs '../../../hyext/node-pack/hyg-libs' }

        // for local test
        // maven {
          // url "https://nexus.huya.com/repository/maven-public/"
        // }
    }

    dependencies {
        classpath 'org.lz4:lz4-java:1.5.0'
        classpath 'org.bouncycastle:bcprov-jdk15on:1.60'
        classpath 'com.huya.hygame.plugin:plugin-hygame-build:0.0.3'

        // for local test
        // classpath 'com.huya.hygame.plugin:plugin-hygame-build:0.0.2'
    }
}


apply plugin: 'java'
apply plugin: 'com.huya.hygame.plugin.hygamebuild'

/**
 * appId 是开发者 id
 * extUuid 是小程序 id
 * extVersionId 是版本code
 * extVersion 是版本号,显示用
 **/

//-PextUuid=uc82uoj6 -PextVersionId=1427 -PextVersion=0.1.1    -PsourceDir=D:\code\plugin-hygame-build\demo  -PtargetDir=D:\code\plugin-hygame-build\target -Prelease=true
hygamebuild {
    buildType = 1
    extUuid = project.getProperties().get("extUuid", null)
    extVersion = project.getProperties().get("extVersion", null)
    extVersionId = project.hasProperty('extVersionId') ? project.getProperties().get("extVersionId") as Integer : null
    release = project.hasProperty('release') ? project.getProperties().get("release") as Boolean : null
    encryptionKey = "eE9sN3NVTT4zLXR4bmBmUg=="
    sourceDir = project.getProperties().get("sourceDir", null)
    targetDir = project.getProperties().get("targetDir", null)
    skipCompressFiles = [".mp3", ".ogg", ".wav"]
    encryptionFiles = [".js", ".lua", ".json", ".xml"]
    packageExtName = ".hyg"
}

task publish {
    doLast {
        println 'build finish.'
        copy {
            from 'build'
            include "*.hyg"
            include "*.md5"
            into 'target/artifacts'
        }
    }
}

tasks.named('publish').configure {
    dependsOn 'hygamebuild'
}
